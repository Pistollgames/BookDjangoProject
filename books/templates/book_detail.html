{% extends 'base.html' %}
{% block title %}{{ book.title }} - Book Tracker{% endblock %}
{% block content %}
<h1>{{ book.title }}</h1>
<h3>{{ book.author }}</h3>
{% if book.description and book.description != 'Описание отсутствует' %}
    <p><strong>Описание:</strong> {{ book.description }}</p>
{% endif %}
{% if book.pages > 0 %}
    <p><strong>Страниц:</strong> {{ book.pages }}</p>
{% endif %}
<p><strong>Добавлена:</strong> {{ book.created|date:"d.m.Y" }}</p>
{% if user.is_authenticated and user == book.user %}
    <h2>Мой прогресс</h2>
    {% if progress %}
        <p><strong>Текущий статус:</strong> 
            {% if progress.status == 'want' %}Хочу прочитать{% endif %}
            {% if progress.status == 'reading' %}Читаю{% endif %}
            {% if progress.status == 'done' %}Прочитано{% endif %}
        </p>
        {% if progress.rating > 0 %}
            <p><strong>Моя оценка:</strong> {{ progress.rating }}/5</p>
        {% endif %}
        {% if progress.updated %}
            <p><strong>Обновлено:</strong> {{ progress.updated|date:"d.m.Y H:i" }}</p>
        {% endif %}
    {% endif %}
    <form method="post" action="{% url 'update_reading' book.id %}">
        {% csrf_token %}
        <label>Статус:</label><br>
        <select name="status">
            <option value="want" {% if progress and progress.status == 'want' %}selected{% endif %}>Хочу прочитать</option>
            <option value="reading" {% if progress and progress.status == 'reading' %}selected{% endif %}>Читаю</option>
            <option value="done" {% if progress and progress.status == 'done' %}selected{% endif %}>Прочитано</option>
        </select><br><br>
        <label>Оценка (1-5):</label><br>
        <select name="rating">
            <option value="0" {% if not progress or progress.rating == 0 %}selected{% endif %}>Нет оценки</option>
            <option value="1" {% if progress and progress.rating == 1 %}selected{% endif %}>1</option>
            <option value="2" {% if progress and progress.rating == 2 %}selected{% endif %}>2</option>
            <option value="3" {% if progress and progress.rating == 3 %}selected{% endif %}>3</option>
            <option value="4" {% if progress and progress.rating == 4 %}selected{% endif %}>4</option>
            <option value="5" {% if progress and progress.rating == 5 %}selected{% endif %}>5</option>
        </select><br><br>
        <button type="submit">Сохранить</button>
    </form>
{% elif not user.is_authenticated %}
    <p><a href="{% url 'login' %}">Войдите</a>, чтобы отслеживать прогресс чтения этой книги.</p>
{% elif user.is_authenticated and user != book.user %}
    <p>Эта книга принадлежит другому пользователю. Вы можете <a href="{% url 'add_book' %}">добавить её в свою коллекцию</a>.</p>
{% endif %}
<p><a href="{% url 'home' %}">← Назад к списку книг</a></p>
{% endblock %}